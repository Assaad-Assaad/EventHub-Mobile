<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"  
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml" 
             xmlns:shared="clr-namespace:EventHub.Shared.Dtos;assembly=EventHub.Shared"
             xmlns:model="clr-namespace:EventHub.Models"  
             xmlns:viewmodel="clr-namespace:EventHub.ViewModels.Event"  
             x:DataType="viewmodel:MyEventsViewModel"  
             x:Class="EventHub.Views.Event.MyEventsPage"  
             Title="My Events">
    
    <ScrollView>
        <!-- Single Root Container -->
        <VerticalStackLayout Padding="15" Spacing="15">
            <!-- Empty View -->
            <VerticalStackLayout IsVisible="{Binding HasNoEvents}" HorizontalOptions="Center" VerticalOptions="Center">
                <Label Text="No favorite events yet."
                   FontSize="18"
                   TextColor="Gray"
                   HorizontalTextAlignment="Center"/>
                <Label Text="Mark events as favorites to see them here!"
                   FontSize="14"
                   TextColor="Gray"
                   HorizontalTextAlignment="Center"
                   Margin="0,5,0,0"/>
            </VerticalStackLayout>
 
            <!-- Event List -->
            <CollectionView ItemsSource="{Binding FavoriteEvents}"
                        IsVisible="{Binding HasFavorites}">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="shared:EventDto">
                        <Border StrokeShape="RoundRectangle 15"  
                            BackgroundColor="White"  
                            Padding="15"
                            Margin="0,5,0,0">
                            <Grid ColumnDefinitions="Auto, *">
                                <!-- Event Image -->
                                <Image Grid.Column="0"  
                                   Source="{Binding Image}"  
                                   HeightRequest="60"  
                                   WidthRequest="60"  
                                   Aspect="AspectFill"/>

                                <!-- Event Details -->
                                <VerticalStackLayout Grid.Column="1" Spacing="5">
                                    <Label Text="{Binding Title}"  
                                       FontSize="18"  
                                       FontAttributes="Bold"  
                                       LineBreakMode="TailTruncation"/>
                                    <Label Text="{Binding Location}"  
                                       FontSize="14"  
                                       TextColor="Gray"  
                                       LineBreakMode="TailTruncation"/>
                                    <Label Text="{Binding Date, StringFormat='On {0:MM/dd/yyyy}'}"  
                                       FontSize="14"  
                                       TextColor="Gray"  
                                       Margin="0,5,0,0"/>
                                </VerticalStackLayout>

                                <!-- Action Buttons -->
                                <Grid ColumnDefinitions="*, *" ColumnSpacing="10" VerticalOptions="End">
                                    <Button Grid.Column="0"  
                                        BackgroundColor="#0078D4"  
                                        TextColor="White"  
                                        CornerRadius="10"  
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:MyEventsViewModel}}, Path=SignInCommand}"  
                                        CommandParameter="{Binding .}"  
                                        Text="Sign In"  
                                        FontSize="14"  
                                        HeightRequest="35"/>

                                    <Button Grid.Column="1"  
                                        BackgroundColor="#FF4D4D"  
                                        TextColor="White"  
                                        CornerRadius="10"  
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:MyEventsViewModel}}, Path=DeleteCommand}"  
                                        CommandParameter="{Binding .}"  
                                        Text="Delete"  
                                        FontSize="14"  
                                        HeightRequest="35"/>
                                </Grid>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>